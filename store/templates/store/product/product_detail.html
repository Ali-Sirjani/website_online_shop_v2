{% extends '_base.html' %}

{% load crispy_forms_filters %}
{% load product_temp_filters %}

{% block title %} products {% endblock title %}

{% block content %}
    <div class="container">
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="card-title">'title: {{ product.title }}'</h5>
            </div>
            <div class="card-body">
                {% for category in product.category.all %}
                    <p class="card-text">
                        <strong>'category'</strong>: {{ category.name }}
                    </p>
                {% endfor %}

                {% for spec_value in product.specs_values.all %}
                    <p class="card-text">
                        <strong>'{{ spec_value.specification.name }}'</strong>: {{ spec_value.value }}
                    </p>
                {% endfor %}

                {% for color_or_size in product.color_size_values.all %}
                    <p class="card-text">
                        <strong>'Color'</strong>: {{ color_or_size.color.name }} <br>
                        <strong>'Size'</strong>: {{ color_or_size.size.size }} <br>
                        <strong>'Size Price'</strong>: {{ color_or_size.size_price }}
                    </p>
                {% endfor %}

                <p class="card-text">
                    <strong>'Short Description'</strong>: {{ product.short_description }}
                </p>
                <p class="card-text">
                    <strong>'Description'</strong>: {{ product.description|safe }}
                </p>

                {% for product_image in product.images.all %}
                    {% if product_image.is_main %}
                        <img src="{{ product_image.image.url }}" alt="Main Image" class="img-thumbnail"
                             style="width: 120px; height: 120px;">
                    {% else %}
                        <img src="{{ product_image.image.url }}" alt="Image" class="img-thumbnail"
                             style="width: 60px; height: 60px;">
                    {% endif %}
                {% endfor %}

                <p class="card-text">
                    <strong>'Price'</strong>: {{ product.price }} <br>
                    <strong>'Discount'</strong>: {{ product.discount }} <br>
                    <strong>'Discount Price'</strong>: {{ product.discount_price }} <br>
                    <strong>'Slug'</strong>: {{ product.slug }}
                </p>
                {% if request.user.is_authenticated %}
                    <form method="post" action="">
                        {% csrf_token %}
                        {{ form|crispy }}
                        <button type="submit" class="btn btn-primary">Submit Comment</button>
                    </form>
                {% else %}
                    <p>You need to be logged in to submit a comment.</p>
                    <a href="{% url 'account_login' %}">Login</a> or
                    <a href="{% url 'account_signup' %}">Sign Up</a>.
                {% endif %}

                <!-- Display Comments -->
                <h4 class="mt-4">Comments | average comment stars: {{ comments|avg_stars }}</h4>
                {% if comments %}
                    <ul class="list-group">
                        {% for comment in comments %}
                            <li class="list-group-item">
                                <div class="media">
                                    <img src="{{ comment.author.profile.picture.url }}" class="mr-3 rounded-circle"
                                         alt="{{ comment.author }}'s picture" width="50" height="50">
                                </div>
                                <div class="media-body">
                                    <h5 class="mt-0">{{ comment }} said:</h5>
                                    <p>{{ comment.text }}</p>
                                    <p><strong>star</strong>: {{ comment.star }}</p>
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No comments yet. Be the first to comment!</p>
                {% endif %}
            </div>
        </div>
        <p>related products</p>
        {% include 'store/product/_show_product_list.html' with products=related_products %}
    </div>

{% endblock content %}